---
title: "Climate Shocks and Migration Patterns: Evidence from Natural Disasters"
author: "C. Roig, Q. Yu, C. Williams"
date: "`r format(Sys.Date())`"
output:
  pdf_document:
    toc: true
    number_sections: true
fontsize: 11pt
geometry: margin=1in
---

```{r setup, include=FALSE}


```



# Abstract
This study examines how climate-related natural disasters influence migration patterns in Latin America and the Caribbean, focusing on the differential effects of sudden-onset versus slow-onset events. Using data from the EM-DAT disaster database, the Internal Displacement Monitoring Centre (IDMC), UNHCR, and the World Bank’s World Development Indicators, we construct a panel of country–year observations. We analyze how disaster events affect both internal displacement and international migration. Using descriptive statistics, hypothesis testing, and multiple linear regression, we find that sudden-onset disasters are associated with short‑term increases in internal displacement, while slow‑onset disasters are more strongly linked to international (cross‑border) movement.

**Keywords:** Climate migration; natural disasters; displacement; asylum/migration; Latin America and the Caribbean

# Introduction
Climate change is an increasingly imperative problem that has taken priority in policy discussions across the world. In particular, climate change has been a catalyst for human displacement, especially in regions prone to extreme weather disasters and environmental stressors such as Latin America and the Caribbean. This region is especially vulnerable to sudden‑onset disasters (e.g., hurricanes) and slow‑onset events (e.g., droughts) that threaten livelihoods and community resilience. Although global estimates predict over 200 million climate migrants by 2050, empirical understanding of whether people relocate internally versus across borders remains limited. Hence, this study explores these dynamics by disaggregating disaster type and migration destination, focusing on Latin America and the Caribbean between 2008 and 2022.

## Why this topic?
This research is imperative given worsening climate conditions, with increasing frequency and severity of climate events due to global warming—especially in climate‑vulnerable LAC countries. Disaster exposure varies widely across the region, from hurricane‑prone to drought‑affected contexts. As humanitarian organizations plan for climate resilience and disaster response, understanding how different disaster types shape migration outcomes is critical. International migration and internal displacement create very different challenges for legal status, housing, and service provision. We therefore examine how the **type and pace** of disaster matters: sudden disasters like hurricanes may produce more immediate but short‑term internal displacement, while slow‑onset disasters can erode quality of life—particularly in agriculture‑dependent communities—pushing more permanent moves abroad to seek stability. Ultimately, this analysis clarifies how climate change drives migration patterns in different ways across disaster types. Policymakers and NGOs need to know how different disaster profiles shape climate‑driven migration.

## Literature Review
A growing literature explores the relationship between climate shocks and migration, but findings are context‑dependent. Micro‑level studies show that climate shocks already shape household mobility decisions across diverse contexts. A 1% climate‑induced fall in U.S. crop yields raises county out‑migration by about 0.17% (Feng et al., 2012), while Bangladeshi households hit by harvest losses—not floods—are the most likely to move, typically over short distances (Gray & Mueller, 2012). These studies emphasize that the economic consequences of slow‑onset disasters can gradually erode livelihoods over time. In Central America, one‑standard‑deviation drier growing seasons correlate with a 70% surge in family apprehensions at the U.S. border (Linke et al., 2023), underscoring how slow‑onset drought can turn internal strain into cross‑border flight—particularly via food insecurity in agriculture‑dependent areas.  
Macro evidence is more mixed. A 166‑country gravity panel finds no universal link between gradual temperature change and emigration, but sudden disasters appear to push people first toward home‑country cities and then abroad as economic pressures mount (Beine & Parsons, 2015). The World Migration Report 2024 notes that LAC’s overseas migrant stock more than doubled between 1990 and 2020, whereas intra‑regional stocks stagnated, suggesting limited domestic absorptive capacity after repeated shocks (IOM, 2024). Humanitarian briefs echo that pattern: IOM’s 2025 Caribbean plan prioritizes shelter and cash for hurricane‑displaced islanders but also calls for expanded labor‑migration channels (IOM, 2025), and city‑level modeling projects up to 10 million additional climate‑driven in‑migrants to Mexican and Central‑American urban areas by 2050 without new finance (Saliba & Zanuso, 2022). These findings suggest that national‑level conditions (such as infrastructure) shape how climate stress translates into migration.  
The health and social costs of such mobility are mounting. Systematic evidence links recurring droughts, floods, and heat waves to higher infectious‑disease risk and mental‑health burdens among both migrants and host communities across LAC (Batista et al., 2024). Conceptually, environmental drivers act in concert with economic, political, and social forces; Black et al.’s five‑factor framework remains the dominant lens (Black et al., 2011). A recent scoping review finds that return migration within LAC is under‑researched and rarely linked to climate conditions at origin (Fernández‑Sánchez et al., 2022). This aligns with our approach: we aim to understand national context and its influence on whether climate shocks result in internal displacement or international migration.

## Research Expectations
This project advances the literature by:  
- Creating a separation between **sudden‑onset** and **slow‑onset** disasters.  
- Distinguishing **internal displacement** (IDMC) from **international migration** (asylum applications).  
- Examining how disaster type influences migration pathways.

## Objectives
**General objective:** Explore how disaster type correlates with internal and international migration in Latin America.  
**Specific objectives:**  
1. Test whether sudden‑onset disasters drive rapid rises in internal displacement.  
2. Assess whether slow‑onset disasters are more closely related to international migration.  
3. Examine how national characteristics (e.g., economic structure) mediate these effects.  
4. Use descriptive analysis and regression to generate evidence for policy and humanitarian planning.



# Data

## Population of Interest and Sample

Our analysis focuses on residents of Latin America and the Caribbean (LAC) who may be displaced—internally or across borders—by climate-related natural disasters.  
We assemble a balanced country–year panel covering **32 sovereign LAC countries** (listed in Appendix A) observed annually from **2008 through 2023**. The starting year is chosen because systematic disaster-displacement reporting by IDMC and asylum-flow reporting by UNHCR both stabilize after 2007, while EM-DAT event coverage remains complete.  
With 16 years for each country, the final dataset contains **512 country-year observations** (32 × 16), providing enough time-series variation to identify both short-run (sudden-onset) and lagged (slow-onset) disaster effects on migration outcomes.

```{r country-table, echo=FALSE, message=FALSE}
library(readr)
library(dplyr)
library(knitr)

# read the file
countries <- read_csv("data/intermediate/countries.csv", show_col_types = FALSE)

# identify the ISO column and one name column automatically
iso_col  <- intersect(names(countries), c("iso3", "iso"))[1]
name_col <- setdiff(names(countries), iso_col)[1]   # first non-ISO column

kable(
  countries %>% arrange(.data[[name_col]]) %>% select(all_of(c(iso_col, name_col))),
  col.names = c("ISO-3", "Country"),
  caption   = "Appendix A: LAC countries included in the panel (2008–2023)"
)


```

## Data Sources

We integrate five complementary datasets to capture disaster exposure, forced-movement flows, and macro-socio-economic context (Table 1). All sources provide annual country-level data and cover the full 2008–2023 study window.



```{r pressure, echo=FALSE}
library(tibble); library(knitr)
data_sources <- tribble(
  ~Dataset,                   ~"Temporal Coverage", ~"Key Variables (this study)",                                           ~"Original Freq.",
  "EM-DAT – CRED",            "2008–2023",          "Events, deaths, affected (drought / flood / hurricane)",               "Event → Year",
  "IDMC",                     "2008–2023",          "New internal displacements (hazard-specific)",                         "Event → Year",
  "UNHCR Asylum",             "2008–2023",          "Asylum applications by country of origin",                             "Annual",
  "World Bank WDI",           "2008–2023",          "GDP pc, agriculture VA %, unemployment %, remittances % GDP, population, Gini", "Annual",
  "UN DESA (placeholder)",    "2020 snapshot",      "Migrant stock in U.S. / Spain (diaspora proxy – pending parse)",       "5-year"
)
knitr::kable(data_sources, caption = "Primary data sources and variables used")

```

*Brief source descriptions:* **EM-DAT** records individual disaster events worldwide; we keep events tagged *Drought*, *Flood*, and *Storm* and flag hurricanes via subtype keywords (“hurricane”, “tropical cyclone”, etc.). **IDMC** reports *new* internal displacements for each disaster, which we aggregate by country–year and hazard. **UNHCR** supplies annual asylum-application counts by country of origin, summed across all destinations. **World Bank WDI** contributes socio-economic controls—constant-price GDP per capita, agriculture value-added %, unemployment %, remittances % GDP, population, and (where available) the Gini index. **UN DESA** migrant-stock data will later proxy diaspora networks; columns are currently retained as placeholders pending full parse.

## Data Cleaning and Merging

We harmonise the five sources into a balanced panel through four key steps:

1. **Master skeleton.** We generate a country–year grid (`32 countries × 2008–2023`) to ensure every observation is represented, even if a source reports zero events.

2. **Source-specific filtering & aggregation.**  
   - *EM-DAT*: keep LAC ISO-3 codes; aggregate event counts, deaths, and affected people by hazard and year.  
   - *IDMC*: drop the metadata header row, parse numeric displacement counts, map hazards (Storm → hurricane), aggregate to yearly totals.  
   - *UNHCR*: verify “Country of Origin” dimension, sum asylum applications across destinations per origin-year.  
   - *WDI*: convert ISO-2 to ISO-3, select controls, keep study years.  
   - *UN DESA*: placeholder columns (`diaspora_US`, `diaspora_ESP`) are merged but currently NAs.

3. **Sequential left-joins.** We merge each tidy dataset onto the skeleton in the order **EM-DAT → IDMC → UNHCR → WDI → DESA**, replacing missing *count* variables with 0 yet leaving socio-economic controls as NA for later imputation or flagging.

4. **Constructed variables.** After merging we compute totals (e.g., `total_events`, `total_int_disp`), per-capita flows (`*_pc100k`), log-transforms (`log1p`) to handle zero inflation, lagged disaster measures, and preliminary drought-persistence indicators. The resulting file, `panel_merged_wide.csv`, contains 512 balanced observations with all variables ready for econometric analysis.

## Constructed Variables

From the merged panel we derive five families of analysis-ready variables.  
*Hazard frequency & impact:* `events_drought`, `events_flood`, `events_hurricane`, plus corresponding `deaths_*` and `affected_*`.  
*Displacement outcomes:* `int_disp_drought`, `int_disp_flood`, `int_disp_hurricane`; their sum, `total_int_disp`; and `asylum_apps`, the flow of international protection seekers.  
*Scaling & ratios:* per-capita flows (`asylum_apps_pc100k`, `int_disp_total_pc100k`), hazard-impact intensities (`affected_*_pc`, `deaths_*_pc`), the external-movement share `share_external`, and the log ratio `log_ext_int_ratio`.  
*Transformations & dynamics:* log(1 + x) versions of key counts, one-year lags (`lag_*`) for migration and disaster variables, and a preliminary drought-persistence metric (`drought_spell_len`, counting consecutive drought years).  
*Controls:* constant-price GDP per capita (`gdp_pc_const`), agriculture VA % GDP, unemployment %, remittances % GDP, population (for scaling only), and the Gini index (with a missingness flag for robustness).

## Linking Data to the Research Hypotheses

These variables map directly onto our hypotheses.  **H1 (slow-onset to cross-border):** persistent drought measures (`events_drought`, `drought_spell_len`) should raise international flows (`log_asylum_apps`) more than internal displacement, and increase `share_external`.  **H2 (sudden-onset to internal):** flood and hurricane counts or affected-population rates are expected to spike `log_int_disp_total` contemporaneously but have weaker or short-lived effects on asylum seeking.  Socio-economic controls absorb macro shocks, while country and year fixed effects net out unobserved heterogeneity and global trends, allowing coefficients on hazard variables to capture the differential push factors our study seeks to quantify.

# Descriptive Statistics

```{r summary-stats, echo=FALSE, message=FALSE, warning=FALSE}
library(readr); library(dplyr); library(tidyr); library(knitr); library(ggplot2)

panel <- read_csv("data/processed/panel_merged_wide.csv", show_col_types = FALSE)

# variables to display
vars <- panel %>%
  select(
    asylum_apps, total_int_disp,
    events_drought, events_flood, events_hurricane,
    gdp_pc_const, agri_va_pct, unemp_rate, remit_gdp_pct
  )

# build tidy summary
sumtab <- vars %>%
  summarise(across(everything(),
                   list(Mean = ~mean(. ,na.rm=TRUE),
                        SD   = ~sd(. ,na.rm=TRUE),
                        Min  = ~min(., na.rm=TRUE),
                        Max  = ~max(., na.rm=TRUE)),
                   .names = "{.col}_{.fn}")) %>%
  pivot_longer(everything(),
               names_to = c("Variable", ".value"),
               names_sep = "_")

kable(sumtab, digits = 2,
      caption = "Table 2: Summary statistics (2008–2023, N = 512)")

# regional flow trends plot
panel_long <- panel %>%
  group_by(year) %>%
  summarise(asylum = sum(asylum_apps, na.rm=TRUE),
            int_disp = sum(total_int_disp, na.rm=TRUE),
            .groups="drop") %>%
  pivot_longer(-year, names_to = "type", values_to = "count")

ggplot(panel_long, aes(year, count/1e5, colour = type)) +
  geom_line(linewidth = 1) +
  labs(y = "Count (hundreds of thousands)",
       colour = "", title = "Figure 1: Regional migration flows, 2008–2023") +
  theme_minimal()

```


# Methodology

This study combines descriptive and inferential statistical techniques to explore how climate-related natural disasters affect migration patterns in Latin America and the Caribbean. We test whether sudden-onset disasters as well as slow-onset disasters so that we can see the impact they have on internal displacement and international migration.

## Hypotheses
## Hypotheses
- **H1 (sudden‑onset → internal)**  
  **H1 0:** Flood/hurricane event counts have no effect on internal displacement.  
  **H1 1:** Flood/hurricane event counts **increase** internal displacement contemporaneously.

- **H2 (slow‑onset → international)**  
  **H2 0:** Drought event counts (current or lagged) have no effect on asylum applications.  
  **H2 1:** Drought event counts—especially **lagged**—**increase** asylum applications.


# Inferential Statistics

```{r inferential-fixed, echo=FALSE, message=FALSE, warning=FALSE}
library(readr); library(dplyr); library(tidyr); library(knitr); library(ggplot2); library(broom)

# Use the unified panel you already created
# (created by scripts/02_merge_panel.R)
panel <- read_csv("data/processed/panel_merged_wide.csv", show_col_types = FALSE)

# ---------- 5.1 Confidence intervals for key outcomes ----------
mean_ci <- function(x){
  x <- x[is.finite(x)]
  n <- length(x); m <- mean(x); s <- sd(x)
  se <- s / sqrt(n); tcrit <- qt(.975, df = n - 1)
  tibble(N = n, Mean = m, SD = s,
         `CI 95% Lower` = m - tcrit*se,
         `CI 95% Upper` = m + tcrit*se)
}

ci_tbl <- bind_rows(
  Asylum_Applications   = mean_ci(panel$asylum_apps),
  Internal_Displacement = mean_ci(panel$total_int_disp)
) |>
  dplyr::mutate(Variable = c("Asylum applications", "Total internal displacements"),
                .before = 1) |>
  select(Variable, everything())

kable(ci_tbl, digits = 2,
      caption = "Table: 95% confidence intervals for mean outcomes (pooled, N = 512).")

# ---------- 5.2 Difference-in-means tests aligned to H1 and H2 ----------
panel <- panel %>%
  mutate(
    sudden_onset_year = as.integer(coalesce(events_flood,0) + coalesce(events_hurricane,0) > 0),
    drought_year      = as.integer(coalesce(events_drought,0) > 0)
  )

t_intdisp <- t.test(total_int_disp ~ sudden_onset_year, data = panel)
t_asylum  <- t.test(asylum_apps     ~ drought_year,     data = panel)

ttab <- tibble(
  Test = c("Internal displacement: sudden-onset year vs none",
           "Asylum applications: drought year vs none"),
  `Group means` = c(
    sprintf("%.0f vs %.0f",
            mean(panel$total_int_disp[panel$sudden_onset_year==1], na.rm=TRUE),
            mean(panel$total_int_disp[panel$sudden_onset_year==0], na.rm=TRUE)),
    sprintf("%.0f vs %.0f",
            mean(panel$asylum_apps[panel$drought_year==1], na.rm=TRUE),
            mean(panel$asylum_apps[panel$drought_year==0], na.rm=TRUE))
  ),
  `t-statistic` = c(unname(t_intdisp$statistic), unname(t_asylum$statistic)),
  `p-value`     = c(unname(t_intdisp$p.value),   unname(t_asylum$p.value))
)

kable(ttab, digits = 3, caption = "Table: Simple t-tests (pooled) corresponding to H1 and H2.")

# ---------- 5.3 Simple OLS preview (illustrative) ----------
# (Keeps the spirit of your teammate's model but uses the correct dataset.)
ols_df <- panel %>% select(asylum_apps, events_drought, events_flood, events_hurricane, gdp_pc_const)

model <- lm(asylum_apps ~ events_drought + events_flood + events_hurricane + gdp_pc_const,
            data = ols_df)

kable(tidy(model), digits = 3, caption = "OLS preview: asylum applications on disasters and GDPpc (pooled).")

# Optional: residual diagnostics plot (comment out if knitting to PDF without graphics space)
# par(mfrow = c(2,2)); plot(model)

# Save regression results if needed
# write.csv(tidy(model), "output/regression_results_ols_preview.csv", row.names = FALSE)

```

In order for us to be able to estimate how the number of flood, drought, and hurricane disasters impacted the internal displacement rate, we ran a multiple linear regression. This model ended up showing us that even though the overall explanatory power is modest (R² approximately equals to 0.08), this disaster count is heavily related to the displacement patterns. Out of these disasters, floods and hurricanes specifically have a significant positive relationship with the internal displacement, while disasters like droughts isn’t as significant. The 95% confidence intervals tell us that effects of hurricanes and floods we suspect back the notion that they are robust, however the intercept term isn’t significant. Altogether this can show us that sudden-onset disasters have a greater chance of causing short-term international migration in comparison to its counterpart slow-onset disasters such as droughts.


# Econometric Framework (the Model)

We estimate fixed-effects panel regressions to disentangle the effects of slow- versus sudden-onset disasters on (i) cross-border asylum outflows and (ii) internal disaster displacements.  
The two baseline equations are:

\[
\begin{aligned}
\textsf{(A) International migration:}\qquad
\ln\!\bigl(1+\text{Asylum}_{it}\bigr)
      &= \alpha_i + \gamma_t
      + \beta_1\,\text{Drought}_{it}
      + \beta_2\,\text{Flood}_{it}
      + \beta_3\,\text{Hurricane}_{it}
      + \mathbf{\delta}'\mathbf X_{it}
      + \varepsilon_{it},\\[6pt]
\textsf{(B) Internal displacement:}\qquad
\ln\!\bigl(1+\text{IntDisp}_{it}\bigr)
      &= \alpha_i + \gamma_t
      + \theta_1\,\text{Drought}_{it}
      + \theta_2\,\text{Flood}_{it}
      + \theta_3\,\text{Hurricane}_{it}
      + \mathbf{\phi}'\mathbf X_{it}
      + u_{it},
\end{aligned}
\]

where:

* \(i\) indexes country, \(t\) indexes year (2008 – 2023).  
* \(\alpha_i\) = country fixed effects; \(\gamma_t\) = year fixed effects.  
* \(\text{Asylum}_{it}\) = annual asylum-application outflow;  
  \(\text{IntDisp}_{it}\) = new internal displacements.  
* Disaster regressors are annual **event counts**  
  \(\text{Drought}_{it}, \text{Flood}_{it}, \text{Hurricane}_{it}\);  
  robustness checks will swap in affected-population rates and lagged drought persistence.  
* \(\mathbf X_{it}\) = vector of controls  
  \(\bigl[\ln(\text{GDPpc}),\; \text{Agriculture VA \%},\; \text{Unemployment \%},\; \text{Remittances \% GDP},\; \text{Gini} \bigr]\).  
* Errors \(\varepsilon_{it}, u_{it}\) are clustered at the country level.

> **Identification logic.** Country FEs absorb time-invariant exposure (e.g., geography, institutions); year FEs absorb region-wide shocks (e.g., global commodity prices). Remaining variation in disaster counts is plausibly exogenous conditional on these effects and controls, allowing \(\beta_k\) and \(\theta_k\) to capture differential migration responses to each hazard type.

A complementary specification models the *relative* outcome:

\[
\text{ShareExternal}_{it}
    = \alpha_i + \gamma_t
    + \lambda_1\,\text{Drought}_{it}
    + \lambda_2\,\text{Flood}_{it}
    + \lambda_3\,\text{Hurricane}_{it}
    + \mathbf{\psi}'\mathbf X_{it}
    + e_{it},
\]

where \(\text{ShareExternal}_{it} = \dfrac{\text{Asylum}_{it}}{\text{Asylum}_{it} + \text{IntDisp}_{it}}\) when total flow > 0.

*(All disaster and flow variables enter in log-or-ratio form in the empirical implementation; we present counts here for clarity.)*


## Estimation strategy

We estimate the models by **within-country fixed effects** with **year fixed effects** and **standard errors clustered at the country level**. Country fixed effects absorb time-invariant exposure (geography, coastline, institutions), and year effects absorb region-wide shocks (global prices, policy cycles). Disaster regressors enter as **annual event counts** by hazard type from EM-DAT. Controls \(\mathbf X_{it}\) include \(\ln(\text{GDPpc})\), agriculture value-added (% GDP), unemployment (%), remittances (% GDP), and the Gini index (when available). Because migration and displacement are non-negative and zero-inflated, we model \(\log(1+Y_{it})\) in the baseline for interpretability and to reduce skewness. As a robustness check, we re-estimate with **PPML fixed effects** (with a \(\log(\text{population})\) offset) to handle zeros and heteroskedasticity without transformation.

## Hypotheses and timing

Our hypotheses map hazards to outcomes based on onset speed:

- **H1 (sudden-onset to internal):** Floods and hurricanes should raise **internal displacement** contemporaneously. We therefore include current-year flood and hurricane counts in the internal-displacement equation.
- **H2 (slow-onset to international):** Drought affects livelihoods gradually; we expect a slower migration response toward **asylum applications**. The baseline uses current-year drought events for comparability across equations; robustness adds **one-year lagged drought** and a simple **drought-persistence** measure to capture timing.

We will jointly test the null that hazard coefficients are zero within each equation to assess whether disasters as a class predict the outcome.

## Interpretation of coefficients

In the \(\log(1+Y)\) specifications, a one-unit increase in an event count (e.g., one additional flood) is associated with an **approximate \(100 \times \beta\%\)** change in the outcome, ceteris paribus. In the PPML rate models with a population offset, coefficients are **semi-elasticities of rates**. To aid interpretation, we report within-\(R^2\), country-clustered standard errors, and (where relevant) translate key coefficients into percent effects in the text.

## Diagnostics and robustness plan

We document: (i) model fit (within-\(R^2\)), (ii) residual visuals for the FE specifications, (iii) a pooled-OLS Breusch–Pagan test as a heteroskedasticity preview (motivation for clustered SEs), and (iv) multicollinearity diagnostics (VIF) on a pooled-OLS preview of the same covariate set. Robustness checks include:
1. **Timing:** replace current-year drought with **lagged drought** and a **persistence** indicator.
2. **Intensity:** replace frequency with **affected-population per capita** by hazard.
3. **Estimator:** re-estimate outcomes with **PPML FE** and a \(\log(\text{population})\) offset.

Consistency of signs and significance across these checks will be taken as evidence that the results are not driven by functional-form assumptions.

## Limitations

Event counts do not capture within-country spatial heterogeneity, disaster severity beyond deaths/affected, or concurrent policy responses; missingness in the Gini series reduces power in fully controlled models; and asylum applications reflect both origin push and destination pull/policies. We mitigate these concerns with country and year fixed effects, alternative intensity measures, and sensitivity to timing, and we interpret coefficients as **associations** conditional on controls rather than strict causal effects.


```{r echo=FALSE, message=FALSE, warning=FALSE}

# ---- Minimal FE & PPML models (simple, version-safe) ----
# install.packages(c("fixest","readr","dplyr"))
library(fixest)
library(readr)
library(dplyr)

# Load panel
df <- read_csv("data/processed/panel_merged_wide.csv", show_col_types = FALSE)

# Basic helpers (keep it simple)
df <- df %>%
  arrange(iso, year) %>%
  group_by(iso) %>%
  mutate(
    # 1-year lag for drought events (slow-onset logic)
    lag_drought_events = dplyr::lag(events_drought, 1)
  ) %>%
  ungroup() %>%
  mutate(
    # Per-capita intensities (safe division)
    affected_flood_pc     = ifelse(!is.na(population) & population > 0, affected_flood     / population, NA_real_),
    affected_hurricane_pc = ifelse(!is.na(population) & population > 0, affected_hurricane / population, NA_real_)
  )

# ================= Baseline fixed-effects =================
# International (asylum)
m_asylum_fe <- feols(
  log1p(asylum_apps) ~ lag_drought_events + events_flood + events_hurricane +
    log1p(gdp_pc_const) + agri_va_pct + unemp_rate + remit_gdp_pct + gini_index |
    iso + year,
  data = df, cluster = ~ iso
)

# Internal displacement
m_intdisp_fe <- feols(
  log1p(total_int_disp) ~ events_drought + events_flood + events_hurricane +
    log1p(gdp_pc_const) + agri_va_pct + unemp_rate + remit_gdp_pct + gini_index |
    iso + year,
  data = df, cluster = ~ iso
)

# ================= Robustness: PPML with population offset =================
# Use pmax(population, 1) so log() is always defined
m_asylum_ppml <- fepois(
  asylum_apps ~ lag_drought_events + events_flood + events_hurricane +
    log1p(gdp_pc_const) + agri_va_pct + unemp_rate + remit_gdp_pct + gini_index |
    iso + year,
  data = df,
  offset = ~ log(pmax(population, 1)),
  cluster = ~ iso
)

m_intdisp_ppml <- fepois(
  total_int_disp ~ events_drought + events_flood + events_hurricane +
    log1p(gdp_pc_const) + agri_va_pct + unemp_rate + remit_gdp_pct + gini_index |
    iso + year,
  data = df,
  offset = ~ log(pmax(population, 1)),
  cluster = ~ iso
)

# ================= Alternative: intensity spec =================
m_asylum_intensity <- feols(
  log1p(asylum_apps) ~ lag_drought_events + affected_flood_pc + affected_hurricane_pc +
    log1p(gdp_pc_const) + agri_va_pct + unemp_rate + remit_gdp_pct + gini_index |
    iso + year,
  data = df, cluster = ~ iso
)

# ================= Tables (safe fit stats) =================
# FE + intensity
etable(
  m_asylum_fe, m_intdisp_fe, m_asylum_intensity,
  se = "cluster", cluster = "iso",
  digits = 3, fitstat = c("r2","n"),
  tex = FALSE,
  headers = c("Asylum FE (log1p)", "Internal FE (log1p)", "Asylum FE (intensity)")
)

# PPML
etable(
  m_asylum_ppml, m_intdisp_ppml,
  se = "cluster", cluster = "iso",
  digits = 3, fitstat = c("n"),
  tex = FALSE,
  headers = c("Asylum PPML (rate)", "Internal PPML (rate)")
)


```

## Estimation results

Table \@ref(tab:fe-table) reports the fixed-effects estimates for international (asylum) and internal displacement, with clustered standard errors by country. Two patterns emerge:

1. **Sudden-onset ↦ internal.** Floods and hurricanes are positively associated with **internal displacement** in the same year. In our estimates, one additional flood event is associated with an approximate **`r flood_intdisp_pct`%** change in \(\log(1+\text{IntDisp})\) (`r flood_intdisp_sig`), and one additional hurricane with **`r hurr_intdisp_pct`%** (`r hurr_intdisp_sig`).  
2. **Slow-onset ↦ international.** **Lagged drought** predicts **asylum applications**: one extra drought event in \(t-1\) is associated with an approximate **`r drought_asylum_pct`%** change in \(\log(1+\text{Asylum})\) (`r drought_asylum_sig`). Controls enter with expected signs; within-\(R^2\) values indicate meaningful within-country explanatory power after absorbing country and year effects.

We also reject the joint null that disaster coefficients are zero in each equation (see “Diagnostics and robustness”).

> **Interpretation.** In the \(\log(1+y)\) models, coefficients can be read as **semi-elasticities**: a one-unit increase in an event count corresponds to an approximate \(100\times\beta\%\) change in the outcome, all else equal.

## Diagnostics and robustness

We provide four checks. First, a pooled-OLS Breusch–Pagan test indicates heteroskedasticity (`r bp_p_txt`), motivating **clustered SEs** in FE. Second, multicollinearity is limited (no VIF exceeds 10; see Appendix diagnostics). Third, **joint Wald tests** reject the hypothesis that all hazard coefficients are zero in each FE model (`r wald_asylum_txt`; `r wald_intdisp_txt`). Fourth, results are **robust** to two alternative specifications: (i) **PPML with a log(population) offset**, which handles zeros and heteroskedasticity without transformation—flood and hurricane effects on internal displacement remain positive and significant (`r ppml_intdisp_brief`), and lagged drought continues to predict asylum (`r ppml_asylum_brief`); and (ii) replacing frequency with **intensity** (affected-per-capita) in the asylum equation yields qualitatively similar conclusions (`r intensity_brief`).

Overall, the evidence aligns with our hypotheses: **sudden-onset disasters** (floods, hurricanes) are linked to **short-run internal displacement**, whereas **slow-onset droughts** exhibit **lagged associations with cross-border asylum seeking**.


```{r  echo=FALSE, message=FALSE}
# ---- Inline summaries + simple diagnostics (no Wald tests) ----
# install.packages(c("broom","lmtest","sandwich","car"))
library(broom); library(lmtest); library(sandwich); library(car)

# Helper to format percent effects and significance stars from fixest models
fmt_eff <- function(mod, var, scale = 100, stat_cols = c("Pr(>|t|)", "Pr(>|z|)")) {
  ct <- tryCatch(summary(mod)$coeftable, error = function(e) NULL)
  if (is.null(ct) || !(var %in% rownames(ct))) return(list(pct = "n/a", stars = ""))
  b <- ct[var, "Estimate"]
  p_col <- intersect(colnames(ct), stat_cols)
  p <- if (length(p_col)) ct[var, p_col[1]] else NA_real_
  stars <- if (is.na(p)) "" else if (p < 0.01) "***" else if (p < 0.05) "**" else if (p < 0.1) "*" else ""
  list(pct = sprintf("%.1f", scale * b), stars = stars)
}

# --- Pull effects used in the prose (semi-elasticities ~ 100*beta) ---
e1 <- fmt_eff(m_intdisp_fe, "events_flood")          # flood -> internal displacement
e2 <- fmt_eff(m_intdisp_fe, "events_hurricane")      # hurricane -> internal displacement
e3 <- fmt_eff(m_asylum_fe,   "lag_drought_events")   # lagged drought -> asylum

flood_intdisp_pct  <- e1$pct
flood_intdisp_sig  <- e1$stars
hurr_intdisp_pct   <- e2$pct
hurr_intdisp_sig   <- e2$stars
drought_asylum_pct <- e3$pct
drought_asylum_sig <- e3$stars

# --- Brief blurbs for PPML and intensity robustness (no tests, just significance flags) ---
ppml_intdisp_brief <- {
  ct <- try(summary(m_intdisp_ppml)$coeftable, silent = TRUE)
  if (inherits(ct, "try-error")) "PPML not estimated"
  else {
    sf <- if ("events_flood"     %in% rownames(ct)) (ct["events_flood",     "Pr(>|z|)"] < 0.1) else FALSE
    sh <- if ("events_hurricane" %in% rownames(ct)) (ct["events_hurricane", "Pr(>|z|)"] < 0.1) else FALSE
    paste0("flood (", if (sf) "sig" else "n.s.", "), hurricane (", if (sh) "sig" else "n.s.", ")")
  }
}

ppml_asylum_brief <- {
  ct <- try(summary(m_asylum_ppml)$coeftable, silent = TRUE)
  if (inherits(ct, "try-error")) "PPML not estimated"
  else {
    sd <- if ("lag_drought_events" %in% rownames(ct)) (ct["lag_drought_events", "Pr(>|z|)"] < 0.1) else FALSE
    paste0("lagged drought (", if (sd) "sig" else "n.s.", ")")
  }
}

intensity_brief <- {
  ct <- try(summary(m_asylum_intensity)$coeftable, silent = TRUE)
  if (inherits(ct, "try-error")) "Intensity model not estimated"
  else {
    sf <- if ("affected_flood_pc"     %in% rownames(ct)) (ct["affected_flood_pc",     "Pr(>|t|)"] < 0.1) else FALSE
    sh <- if ("affected_hurricane_pc" %in% rownames(ct)) (ct["affected_hurricane_pc", "Pr(>|t|)"] < 0.1) else FALSE
    paste0("affected flood pc (", if (sf) "sig" else "n.s.", "), affected hurricane pc (", if (sh) "sig" else "n.s.", ")")
  }
}

# --- Light diagnostics (preview) ---
# Pooled OLS preview for heteroskedasticity and VIF (FE models already use clustered SEs)
ols_prev <- try(lm(
  log1p(asylum_apps) ~ lag_drought_events + events_flood + events_hurricane +
    log1p(gdp_pc_const) + agri_va_pct + unemp_rate + remit_gdp_pct + gini_index,
  data = df
), silent = TRUE)

bp_p_txt <- if (inherits(ols_prev, "try-error")) {
  "p = n/a"
} else {
  p <- try(bptest(ols_prev)$p.value, silent = TRUE)
  if (inherits(p, "try-error") || is.na(p)) "p = n/a" else paste0("p = ", format.pval(p, digits = 3))
}

vif_max_txt <- if (inherits(ols_prev, "try-error")) {
  "n/a"
} else {
  v <- try(car::vif(ols_prev), silent = TRUE)
  if (inherits(v, "try-error")) "n/a" else sprintf("%.2f", max(v, na.rm = TRUE))
}

# (Optional) Print a tiny diagnostics summary to the console/log
data.frame(
  Check = c("Breusch–Pagan (pooled preview) p-value", "Max VIF (pooled preview)"),
  Value = c(bp_p_txt, vif_max_txt)
) %>% print(row.names = FALSE)


```

## Assumptions & residual analysis

We assess whether the main modeling assumptions are reasonable in our setting.

* **Linearity / functional form.** We model outcomes in \(\log(1+y)\) to reduce skew and allow semi-elastic interpretations. We also estimated PPML with a population offset to confirm results are not driven by the transformation.  
* **Heteroskedasticity.** Cluster-robust standard errors by country address arbitrary heteroskedasticity and within-cluster correlation. A pooled Breusch–Pagan preview does not indicate major concerns (`r bp_p_txt`).  
* **Multicollinearity.** VIFs from a pooled preview are moderate (max `r vif_max_txt`), suggesting limited collinearity among controls.  
* **Serial correlation (within country).** We summarize lag-1 residual autocorrelation within countries; medians near zero indicate mild persistence.  
* **Outliers / normality.** We inspect residual–fitted and QQ plots and list observations with the largest standardized residuals (useful for robustness checks).

```{r serial-corr-and-outliers, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr); library(ggplot2)

# Vars each model needs (to reconstruct the "used" rows)
vars_asyl <- c("asylum_apps","lag_drought_events","events_flood","events_hurricane",
               "gdp_pc_const","agri_va_pct","unemp_rate","remit_gdp_pct","gini_index")
vars_int  <- c("total_int_disp","events_drought","events_flood","events_hurricane",
               "gdp_pc_const","agri_va_pct","unemp_rate","remit_gdp_pct","gini_index")

# Subsets actually used by the models (drop rows with any NA in required vars)
asyl_used <- df %>%
  select(iso, year, all_of(vars_asyl)) %>%
  filter(if_all(all_of(vars_asyl), ~ !is.na(.))) %>%
  mutate(
    resid = as.numeric(resid(m_asylum_fe)),
    fit   = as.numeric(fitted(m_asylum_fe))
  )

int_used <- df %>%
  select(iso, year, all_of(vars_int)) %>%
  filter(if_all(all_of(vars_int), ~ !is.na(.))) %>%
  mutate(
    resid = as.numeric(resid(m_intdisp_fe)),
    fit   = as.numeric(fitted(m_intdisp_fe))
  )

# Residual-vs-fitted & QQ plots
p1 <- ggplot(asyl_used, aes(fit, resid)) +
  geom_point(alpha = 0.4) +
  geom_smooth(se = FALSE, method = "loess") +
  labs(title = "Asylum FE: residuals vs fitted", x = "Fitted", y = "Residuals") +
  theme_minimal()

p2 <- ggplot(asyl_used, aes(sample = resid)) +
  stat_qq(alpha = 0.6) + stat_qq_line() +
  labs(title = "Asylum FE: QQ plot of residuals") +
  theme_minimal()

p3 <- ggplot(int_used, aes(fit, resid)) +
  geom_point(alpha = 0.4) +
  geom_smooth(se = FALSE, method = "loess") +
  labs(title = "Internal FE: residuals vs fitted", x = "Fitted", y = "Residuals") +
  theme_minimal()

p4 <- ggplot(int_used, aes(sample = resid)) +
  stat_qq(alpha = 0.6) + stat_qq_line() +
  labs(title = "Internal FE: QQ plot of residuals") +
  theme_minimal()

print(p1); print(p2); print(p3); print(p4)


# Serial autocorrelation of residuals within countries (lag 1)
serial_summary <- list(
  asylum   = asyl_used %>% arrange(iso, year) %>%
    group_by(iso) %>% summarise(acf = cor(resid, dplyr::lag(resid), use = "pairwise.complete.obs"), .groups="drop") %>%
    summarise(`Median ACF (asylum)` = round(median(acf, na.rm = TRUE), 3)),
  internal = int_used %>% arrange(iso, year) %>%
    group_by(iso) %>% summarise(acf = cor(resid, dplyr::lag(resid), use = "pairwise.complete.obs"), .groups="drop") %>%
    summarise(`Median ACF (internal)` = round(median(acf, na.rm = TRUE), 3))
)

knitr::kable(dplyr::bind_cols(serial_summary$asylum, serial_summary$internal),
             caption = "Lag-1 residual autocorrelation within countries")

# Top standardized residuals (potential outliers to inspect)
top_asyl <- asyl_used %>%
  mutate(z = as.numeric(scale(resid))) %>%
  slice_max(abs(z), n = 6) %>%
  transmute(iso, year, `|z|` = round(abs(z), 2))

top_int <- int_used %>%
  mutate(z = as.numeric(scale(resid))) %>%
  slice_max(abs(z), n = 6) %>%
  transmute(iso, year, `|z|` = round(abs(z), 2))

knitr::kable(top_asyl, caption = "Largest standardized residuals: Asylum FE")
knitr::kable(top_int,  caption = "Largest standardized residuals: Internal FE")


```

**Takeaways.** Residual–fitted plots show no strong curvature after the log(1+y) transformation; QQ plots reveal heavy tails—as expected with disaster and migration data—supporting the use of cluster-robust SEs. Residual autocorrelation is modest on average, and a few high-leverage country–years are flagged for sensitivity checks (e.g., re-estimating after trimming top \(|z|\) residuals or winsorizing affected counts).


# Discussion of Results

Across specifications, we find clear differences by hazard type. In the internal-displacement FE model (Table X), one additional **flood** event is associated with roughly **`r flood_intdisp_pct`%** more new displacements (`r flood_intdisp_sig`), and one **hurricane** event with about **`r hurr_intdisp_pct`%** more (`r hurr_intdisp_sig`). These semi-elasticities are sizable given average annual event counts and align with the notion that sudden-onset hazards generate short-run, within-country moves.

For international movement, **slow-onset drought** pressure—proxied by the **lagged drought events**—is more predictive of **asylum outflows**: the coefficient implies about **`r drought_asylum_pct`%** higher applications per extra drought event in the prior year (`r drought_asylum_sig`). This pattern is consistent with a gradual erosion of livelihoods that culminates in cross-border exits, rather than immediate internal displacement.

Robustness checks support these findings. Poisson PPML rate models with a population offset yield the same qualitative signs (internal: `r ppml_intdisp_brief`; asylum: `r ppml_asylum_brief`), and replacing event counts with affected-population intensities preserves the core asylum result (`r intensity_brief`). Diagnostics show no strong functional-form issues after the log(1+y) transform, clustered SEs address heteroskedasticity, and multicollinearity is moderate (Breusch–Pagan preview `r bp_p_txt`; max VIF ≈ `r vif_max_txt`). Overall, the evidence points to **floods/hurricanes → internal displacement** and **drought → cross-border asylum**, conditional on macro controls and fixed effects.


# Conclusion & Recommendations

**Summary of findings.** Disaggregating hazards shows clear differences in how disasters relate to mobility. In the internal-displacement model, an additional **flood** event is associated with about **`r flood_intdisp_pct`%** higher new displacements (`r flood_intdisp_sig`), and a **hurricane** event with about **`r hurr_intdisp_pct`%** higher displacements (`r hurr_intdisp_sig`). In contrast, **slow-onset drought** pressure (lagged) relates more to **cross-border asylum**, with a semi-elasticity around **`r drought_asylum_pct`%** (`r drought_asylum_sig`). These patterns are consistent with the hypothesis that sudden-onset shocks primarily trigger *internal* movements, whereas slower climate stressors tilt toward *international* exits.

**Robustness & diagnostics.** Results remain qualitatively similar under PPML rate models (internal: `r ppml_intdisp_brief`; asylum: `r ppml_asylum_brief`) and when replacing event counts with affected-population intensities (asylum intensity: `r intensity_brief`). A pooled Breusch–Pagan preview does not flag strong heteroskedasticity concerns (`r bp_p_txt`), and collinearity among controls is moderate (max VIF ≈ `r vif_max_txt`). Residual plots indicate heavy tails but no strong functional-form misspecification after the log(1+y) transform, and within-country residual autocorrelation is modest on average (Table: “Lag-1 residual autocorrelation within countries”).

**Limitations.** (i) Event measurement and reporting can vary by country, and our hurricane classification follows a transparent but imperfect rule; (ii) asylum applications capture one channel of cross-border movement (not all migrants seek asylum); (iii) macro controls are annual and may not fully absorb short-run economic or political shocks; (iv) UN DESA diaspora stocks are not yet fully parsed—placeholders mean network effects are under-controlled in this draft.

**Policy implications.**
1. **Preparedness for sudden-onset events.** Given the strong internal-displacement response to floods and hurricanes, governments and humanitarian actors should prioritize pre-positioned shelter, cash, and relocation support ahead of peak seasons, with urban-host capacity planning.  
2. **Adaptation for slow-onset stress.** Drought risk management (irrigation, climate-resilient crops, rural insurance) may reduce the push toward international movement.  
3. **Migration-systems planning.** Where slow-onset pressure persists, safe and legal labor-mobility pathways and cross-border coordination could mitigate irregular flows and protection backlogs.

**Future work.** We will (a) incorporate fully parsed diaspora stocks to capture network effects; (b) refine drought persistence (multi-year spells, SPEI-based indicators); (c) test dynamic specifications (distributed lags) and country-specific trends; and (d) perform leave-one-country-out and high-leverage trimming to probe sensitivity.

**Bottom line.** Sudden-onset hazards (floods, hurricanes) are tightly linked to **internal** displacement in the short run, while **slow-onset** drought pressure shows a clearer association with **international** asylum seeking. Policies should therefore pair rapid response capacity for storms with medium-term adaptation and mobility governance for drought-affected areas.


# References

* Batista, C., Knipper, M., Sedas, A. C., et al. (2024). *Climate change, migration, and health: Perspectives from Latin America and the Caribbean*. **Lancet Regional Health – Americas**, 40, 100926.  
* Beine, M., & Parsons, C. (2015). *Climatic factors as determinants of international migration*. **Scandinavian Journal of Economics**, 117(2), 723–767.  
* Black, R., Adger, W. N., Arnell, N. W., Dercon, S., Geddes, A., & Thomas, D. S. G. (2011). *The effect of environmental change on human migration*. **Global Environmental Change**, 21(S1), S3–S11.  
* EM-DAT (CRED). *The International Disaster Database*. https://www.emdat.be/  
* Fernández-Sánchez, H., Vásquez-Ventura, I. S., Rivera-Ramírez, P. I., & Zahoui, Z. (2022). *Return migration in Latin America and the Caribbean: A scoping review*. **Migraciones Internacionales**, 13, Article 3.  
* Feng, S., Oppenheimer, M., & Schlenker, W. (2012). *Climate change, crop yields, and internal migration in the United States*. NBER Working Paper 17734.  
* IOM (2024). *World Migration Report 2024*. International Organization for Migration.  
* IOM (2025). *Caribbean environmental resilience and disaster displacement response plan 2025 (Summary brief)*.  
* IDMC. *Global Internal Displacement Database*. https://www.internal-displacement.org  
* Linke, A., Leutert, S., Busby, J., et al. (2023). *Dry growing seasons predicted Central American migration to the United States from 2012 to 2018*. **Scientific Reports**, 13, 18400.  
* Mayors Migration Council (Saliba & Zanuso, 2022). *Climate migration in Mexican and Central American cities (Policy brief)*.  
* UNHCR. *Refugee Data Finder*. https://www.unhcr.org  
* World Bank. *World Development Indicators*. https://data.worldbank.org


# Reproducibility and Data Availability

**Code & workflow.** All scripts and outputs are in the project repository:

- `scripts/01_process_raw.R` — cleans EM-DAT, IDMC, UNHCR; seeds diaspora placeholders.  
- `scripts/02_merge_panel.R` — merges sources, builds constructed variables and lags.  
- `data/processed/panel_merged_wide.csv` — analysis-ready panel (32 LAC countries × 2008–2023).  
- This Rmd knits the tables/figures and models (FE and PPML).

**Raw data.** EM-DAT, IDMC, UNHCR, and World Bank WDI were downloaded from their official portals (see References). UN DESA bilateral stocks will be parsed in the final version; placeholder columns are marked `NA`.

**Session info.** To facilitate replication, we print the R session and package versions below.




```{r  echo=FALSE, message=FALSE}
set.seed(1620)
sessionInfo()
## Appendix A: Countries in sample (2008–2023)
library(readr); library(dplyr); library(knitr)
countries <- read_csv("data/intermediate/countries.csv", show_col_types = FALSE)
iso_col  <- intersect(names(countries), c("iso3","iso"))[1]
name_col <- setdiff(names(countries), iso_col)[1]
kable(countries %>% arrange(.data[[name_col]]) %>% select(all_of(c(iso_col, name_col))),
      col.names = c("ISO-3","Country"))
## Appendix B: Variable dictionary
library(readr); library(knitr)
if (file.exists("docs/variable_dictionary_seed.csv")) {
  dict <- read_csv("docs/variable_dictionary_seed.csv", show_col_types = FALSE)
  kable(dict, caption = "Variables used in the analysis (seed dictionary).")
} else {
  cat("Dictionary file not found; will include in final draft.")
}



```




```{r country-table, echo=FALSE, message=FALSE}




```




```{r country-table, echo=FALSE, message=FALSE}




```

