"0","library(dplyr); library(ggplot2)"
"0",""
"0","# Vars each model needs (to reconstruct the ""used"" rows)"
"0","vars_asyl <- c(""asylum_apps"",""lag_drought_events"",""events_flood"",""events_hurricane"","
"0","               ""gdp_pc_const"",""agri_va_pct"",""unemp_rate"",""remit_gdp_pct"",""gini_index"")"
"0","vars_int  <- c(""total_int_disp"",""events_drought"",""events_flood"",""events_hurricane"","
"0","               ""gdp_pc_const"",""agri_va_pct"",""unemp_rate"",""remit_gdp_pct"",""gini_index"")"
"0",""
"0","# Subsets actually used by the models (drop rows with any NA in required vars)"
"0","asyl_used <- df %>%"
"0","  select(iso, year, all_of(vars_asyl)) %>%"
"0","  filter(if_all(all_of(vars_asyl), ~ !is.na(.))) %>%"
"0","  mutate("
"0","    resid = as.numeric(resid(m_asylum_fe)),"
"0","    fit   = as.numeric(fitted(m_asylum_fe))"
"0","  )"
"0",""
"0","int_used <- df %>%"
"0","  select(iso, year, all_of(vars_int)) %>%"
"0","  filter(if_all(all_of(vars_int), ~ !is.na(.))) %>%"
"0","  mutate("
"0","    resid = as.numeric(resid(m_intdisp_fe)),"
"0","    fit   = as.numeric(fitted(m_intdisp_fe))"
"0","  )"
"0",""
"0","# Residual-vs-fitted & QQ plots"
"0","p1 <- ggplot(asyl_used, aes(fit, resid)) +"
"0","  geom_point(alpha = 0.4) +"
"0","  geom_smooth(se = FALSE, method = ""loess"") +"
"0","  labs(title = ""Asylum FE: residuals vs fitted"", x = ""Fitted"", y = ""Residuals"") +"
"0","  theme_minimal()"
"0",""
"0","p2 <- ggplot(asyl_used, aes(sample = resid)) +"
"0","  stat_qq(alpha = 0.6) + stat_qq_line() +"
"0","  labs(title = ""Asylum FE: QQ plot of residuals"") +"
"0","  theme_minimal()"
"0",""
"0","p3 <- ggplot(int_used, aes(fit, resid)) +"
"0","  geom_point(alpha = 0.4) +"
"0","  geom_smooth(se = FALSE, method = ""loess"") +"
"0","  labs(title = ""Internal FE: residuals vs fitted"", x = ""Fitted"", y = ""Residuals"") +"
"0","  theme_minimal()"
"0",""
"0","p4 <- ggplot(int_used, aes(sample = resid)) +"
"0","  stat_qq(alpha = 0.6) + stat_qq_line() +"
"0","  labs(title = ""Internal FE: QQ plot of residuals"") +"
"0","  theme_minimal()"
"0",""
"0","print(p1); print(p2); print(p3); print(p4)"
