"0",""
"0","# ---- Minimal FE & PPML models (simple, version-safe) ----"
"0","# install.packages(c(""fixest"",""readr"",""dplyr""))"
"0","library(fixest)"
"0","library(readr)"
"0","library(dplyr)"
"0",""
"0","# Load panel"
"0","df <- read_csv(""data/processed/panel_merged_wide.csv"", show_col_types = FALSE)"
"0",""
"0","# Basic helpers (keep it simple)"
"0","df <- df %>%"
"0","  arrange(iso, year) %>%"
"0","  group_by(iso) %>%"
"0","  mutate("
"0","    # 1-year lag for drought events (slow-onset logic)"
"0","    lag_drought_events = dplyr::lag(events_drought, 1)"
"0","  ) %>%"
"0","  ungroup() %>%"
"0","  mutate("
"0","    # Per-capita intensities (safe division)"
"0","    affected_flood_pc     = ifelse(!is.na(population) & population > 0, affected_flood     / population, NA_real_),"
"0","    affected_hurricane_pc = ifelse(!is.na(population) & population > 0, affected_hurricane / population, NA_real_)"
"0","  )"
"0",""
"0","# ================= Baseline fixed-effects ================="
"0","# International (asylum)"
"0","m_asylum_fe <- feols("
"0","  log1p(asylum_apps) ~ lag_drought_events + events_flood + events_hurricane +"
"0","    log1p(gdp_pc_const) + agri_va_pct + unemp_rate + remit_gdp_pct + gini_index |"
"0","    iso + year,"
"0","  data = df, cluster = ~ iso"
"0",")"
"0",""
"0","# Internal displacement"
"0","m_intdisp_fe <- feols("
"0","  log1p(total_int_disp) ~ events_drought + events_flood + events_hurricane +"
"0","    log1p(gdp_pc_const) + agri_va_pct + unemp_rate + remit_gdp_pct + gini_index |"
"0","    iso + year,"
"0","  data = df, cluster = ~ iso"
"0",")"
"0",""
"0","# ================= Robustness: PPML with population offset ================="
"0","# Use pmax(population, 1) so log() is always defined"
"0","m_asylum_ppml <- fepois("
"0","  asylum_apps ~ lag_drought_events + events_flood + events_hurricane +"
"0","    log1p(gdp_pc_const) + agri_va_pct + unemp_rate + remit_gdp_pct + gini_index |"
"0","    iso + year,"
"0","  data = df,"
"0","  offset = ~ log(pmax(population, 1)),"
"0","  cluster = ~ iso"
"0",")"
"0",""
"0","m_intdisp_ppml <- fepois("
"0","  total_int_disp ~ events_drought + events_flood + events_hurricane +"
"0","    log1p(gdp_pc_const) + agri_va_pct + unemp_rate + remit_gdp_pct + gini_index |"
"0","    iso + year,"
"0","  data = df,"
"0","  offset = ~ log(pmax(population, 1)),"
"0","  cluster = ~ iso"
"0",")"
"0",""
"0","# ================= Alternative: intensity spec ================="
"0","m_asylum_intensity <- feols("
"0","  log1p(asylum_apps) ~ lag_drought_events + affected_flood_pc + affected_hurricane_pc +"
"0","    log1p(gdp_pc_const) + agri_va_pct + unemp_rate + remit_gdp_pct + gini_index |"
"0","    iso + year,"
"0","  data = df, cluster = ~ iso"
"0",")"
"0",""
"0","# ================= Tables (safe fit stats) ================="
"0","# FE + intensity"
"0","etable("
"0","  m_asylum_fe, m_intdisp_fe, m_asylum_intensity,"
"0","  se = ""cluster"", cluster = ""iso"","
"0","  digits = 3, fitstat = c(""r2"",""n""),"
"0","  tex = FALSE,"
"0","  headers = c(""Asylum FE (log1p)"", ""Internal FE (log1p)"", ""Asylum FE (intensity)"")"
"0",")"
"1","                             m_asylum_fe          m_intdisp_fe    m_asylum_intensity"
"1","
"
"1","                       Asylum FE (log1p)   Internal FE (log1p) Asylum FE (intensity)"
"1","
"
"1","Dependent Var.:       log1p(asylum_apps) log1p(total_int_disp)    log1p(asylum_apps)"
"1","
"
"1","                                                                                    "
"1","
"
"1","lag_drought_events         0.036 (0.139)                               0.034 (0.133)"
"1","
"
"1","events_flood              -0.020 (0.036)        0.511* (0.211)                      "
"1","
"
"1","events_hurricane         -0.146* (0.063)         1.23* (0.461)                      "
"1","
"
"1","log1p(gdp_pc_const)       -4.35** (1.52)           4.35 (5.30)         -4.21* (1.62)"
"1","
"
"1","agri_va_pct               -0.111 (0.075)       -0.460. (0.265)        -0.112 (0.077)"
"1","
"
"1","unemp_rate                 0.094 (0.062)        0.334. (0.190)         0.097 (0.060)"
"1","
"
"1","remit_gdp_pct             -0.080 (0.066)        0.259. (0.144)        -0.081 (0.066)"
"1","
"
"1","gini_index                -0.038 (0.044)         0.274 (0.173)        -0.043 (0.047)"
"1","
"
"1","events_drought                                  -0.344 (0.658)                      "
"1","
"
"1","affected_flood_pc                                                       0.241 (1.19)"
"1","
"
"1","affected_hurricane_pc                                                   -4.09 (3.87)"
"1","
"
"1","Fixed-Effects:        ------------------ ---------------------    ------------------"
"1","
"
"1","iso                                  Yes                   Yes                   Yes"
"1","
"
"1","year                                 Yes                   Yes                   Yes"
"1","
"
"1","_____________________ __________________ _____________________    __________________"
"1","
"
"1","S.E.: Clustered                  by: iso               by: iso               by: iso"
"1","
"
"1","R2                               0.95717               0.51483               0.95642"
"1","
"
"1","Observations                         211                   225                   211"
"1","
"
"1","---
Signif. codes: 0 "
"1",""
"1","'***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1"
"1",""
"1"," ' ' 1
"
"0","# PPML"
"0","etable("
"0","  m_asylum_ppml, m_intdisp_ppml,"
"0","  se = ""cluster"", cluster = ""iso"","
"0","  digits = 3, fitstat = c(""n""),"
"0","  tex = FALSE,"
"0","  headers = c(""Asylum PPML (rate)"", ""Internal PPML (rate)"")"
"0",")"
"1","                         m_asylum_ppml       m_intdisp_ppml"
"1","
"
"1","                    Asylum PPML (rate) Internal PPML (rate)"
"1","
"
"1","Dependent Var.:            asylum_apps       total_int_disp"
"1","
"
"1","                                                           "
"1","
"
"1","lag_drought_events     0.404** (0.142)                     "
"1","
"
"1","events_flood             0.026 (0.028)       0.215* (0.101)"
"1","
"
"1","events_hurricane        -0.188 (0.158)       -0.123 (0.291)"
"1","
"
"1","log1p(gdp_pc_const)      -5.32* (2.28)          3.64 (2.61)"
"1","
"
"1","agri_va_pct             -0.058 (0.093)      -0.347* (0.137)"
"1","
"
"1","unemp_rate             0.168** (0.053)       0.292* (0.140)"
"1","
"
"1","remit_gdp_pct          -0.099. (0.052)       -0.036 (0.130)"
"1","
"
"1","gini_index              -0.024 (0.074)        0.032 (0.095)"
"1","
"
"1","events_drought                               0.486* (0.248)"
"1","
"
"1","Fixed-Effects:         ---------------      ---------------"
"1","
"
"1","iso                                Yes                  Yes"
"1","
"
"1","year                               Yes                  Yes"
"1","
"
"1","___________________    _______________      _______________"
"1","
"
"1","S.E.: Clustered                by: iso              by: iso"
"1","
"
"1","Observations                       211                  223"
"1","
"
"1","---
Signif. codes: 0 "
"1",""
"1","'***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1"
"1",""
"1"," ' ' 1
"
